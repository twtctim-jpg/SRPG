<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>八域勇者錄｜終極版</title>
<style>
body{background:#0e0e1a;color:#fff;font-family:Arial;margin:0;padding:0;}
h1{text-align:center;background:linear-gradient(90deg,#ff00cc,#00ffff);-webkit-background-clip:text;color:transparent;margin:10px 0;}
.panel{border:1px solid #444;padding:10px;margin:10px;background:#181830}
button{padding:6px 10px;margin:4px;border-radius:6px;border:none;cursor:pointer}
button:disabled{opacity:.4}
.hp{color:#ff6666}.mp{color:#66aaff}.gold{color:#ffd700}
.enemy{border:1px solid #555;padding:6px;margin:4px;cursor:pointer}
.enemy.dead{opacity:.4}
.item{border:1px dashed #555;padding:6px;margin:4px;cursor:pointer}
</style>
</head>
<body>
<h1>八域勇者錄</h1>

<div id="select" class="panel">
<h3>選擇角色</h3>
<button onclick="start('Warrior')">戰士</button>
<button onclick="start('Mage')">法師</button>
<button onclick="start('Rogue')">刺客</button>
<button onclick="start('Paladin')">聖騎士</button>
</div>

<div id="game" style="display:none">
<div id="info" class="panel"></div>
<div id="enemies" class="panel"></div>
<div id="skills" class="panel"></div>
<div id="equip" class="panel"></div>
<div id="bag" class="panel"></div>
<div id="shop" class="panel">
<button onclick="buyPotion()">藥水 50G</button>
</div>
</div>

<script>
// ===== 基本資料 =====
let player={}, enemies=[];
let zone=1,kills=0,need=45;

const monsterNames=[
["史萊姆","野狼","蝙蝠","毒蛇","小巨人"],
["哥布林","骷髏兵","毒蛛","暗影狼","野豬"],
["獸人","暗影犬","腐屍","狼人","毒蠍"],
["黑騎士","幽魂","詛咒傀儡","魔眼","冰霜巨人"],
["炎魔","熔岩獸","火靈","熔岩魔蛇","火焰巨狼"],
["冰魔","霜狼","寒屍","冰龍","雪人"],
["深淵惡魔","虛空獸","暗影龍","黑暗妖精","邪惡石像"],
["終焉使徒","混沌魔神","毀滅龍","末日魔王","深淵龍王"]
];

const equipmentPool=[
{name:"鐵劍",atk:10},
{name:"魔導杖",atk:14},
{name:"迅捷匕首",atk:12},
{name:"聖盾",hp:40}
];

// ===== 角色技能 =====
const ROLE_SKILLS={
Warrior:[
{id:"strike",name:"猛擊",type:"single",mp:10,cd:1,now:0,baseScale:1.5},
{id:"cleave",name:"旋風斬",type:"multi",mp:20,cd:2,now:0,baseScale:1.2},
{id:"stun",name:"震地斬",type:"control",mp:25,cd:3,now:0,stun:0.2},
{id:"ultimate",name:"破天斬",type:"ult",mp:50,cd:5,now:0,baseScale:2.5},
{id:"heal",name:"回復術",type:"heal",mp:25,cd:2,now:0,rate:0.25}
],
Mage:[
{id:"fireball",name:"火球術",type:"single",mp:15,cd:1,now:0,baseScale:1.5},
{id:"meteor",name:"隕石術",type:"multi",mp:25,cd:3,now:0,baseScale:1.3},
{id:"frost",name:"冰封術",type:"control",mp:20,cd:2,now:0,slow:2},
{id:"ult",name:"雷神降臨",type:"ult",mp:60,cd:5,now:0,baseScale:2.8},
{id:"heal",name:"治癒魔法",type:"heal",mp:25,cd:2,now:0,rate:0.25}
],
Rogue:[
{id:"stab",name:"背刺",type:"single",mp:10,cd:1,now:0,baseScale:1.6},
{id:"fanblade",name:"疾風連斬",type:"multi",mp:20,cd:2,now:0,baseScale:1.2},
{id:"poisoncloud",name:"毒霧",type:"control",mp:25,cd:3,now:0,poison:3},
{id:"ult",name:"影舞大連擊",type:"ult",mp:50,cd:5,now:0,baseScale:2.5},
{id:"heal",name:"急救",type:"heal",mp:25,cd:2,now:0,rate:0.25}
],
Paladin:[
{id:"smite",name:"聖擊",type:"single",mp:15,cd:1,now:0,baseScale:1.5},
{id:"holywave",name:"聖光波",type:"multi",mp:25,cd:2,now:0,baseScale:1.3},
{id:"shieldbash",name:"盾擊",type:"control",mp:20,cd:2,now:0,stun:0.2},
{id:"ult",name:"天罰聖劍",type:"ult",mp:60,cd:5,now:0,baseScale:3.0},
{id:"heal",name:"聖療",type:"heal",mp:25,cd:2,now:0,rate:0.25}
]
};

// ===== 存檔 =====
function save(){localStorage.setItem("srpg_final",JSON.stringify({player,zone,kills,need,enemies}));}
function load(){
let s=localStorage.getItem("srpg_final");
if(!s)return;
({player,zone,kills,need,enemies}=JSON.parse(s));
document.getElementById("select").style.display="none";
document.getElementById("game").style.display="block";
render();
}
load();

// ===== 選角 =====
function start(role){
player={role,level:1,exp:0,gold:100,atk:20,def:5,hp:200,maxHp:200,mp:100,maxMp:100,skills:JSON.parse(JSON.stringify(ROLE_SKILLS[role])),equip:{weapon:null,armor:null},bag:[]};
document.getElementById("select").style.display="none";
document.getElementById("game").style.display="block";
nextWave(); render(); save();
}

// ===== 波次生成 =====
function nextWave(){
enemies=[];
let waveCount=3+Math.floor(Math.random()*4);
for(let i=0;i<waveCount;i++){
 let mName=monsterNames[zone-1][Math.floor(Math.random()*monsterNames[zone-1].length)];
 enemies.push({name:mName,hp:120+zone*25,atk:5+zone*5,def:2+zone,alive:true,special:null,goldDrop:10+zone*5,itemDrop:Math.random()<0.3?equipmentPool[Math.floor(Math.random()*equipmentPool.length)]:null});
}
render(); save();
}

// ===== 技能 UI =====
function renderSkills(){
const area=document.getElementById("skills"); area.innerHTML="<b>技能</b><br>";
player.skills.forEach((s,i)=>{
 let b=document.createElement("button");
 b.innerText=`${s.name} Lv${s.lv} ${s.now?`CD:${s.now}`:""} MP:${s.mp}`;
 b.disabled=s.now>0||player.mp<s.mp||player.hp<=0;
 b.onclick=()=>useSkill(i);
 area.appendChild(b);
 area.appendChild(document.createElement("br"));
});
}

// ===== 技能施放 =====
function useSkill(i){
let s=player.skills[i];
if(s.now>0||player.mp<s.mp||player.hp<=0)return;
player.mp-=s.mp; s.now=s.cd;
if(s.type==="single"){
 let target=enemies.find(e=>e.alive); if(!target)return;
 target.hp-=Math.floor(player.atk*s.baseScale);
 if(target.hp<=0){target.alive=false;kills++;player.exp+=20;player.gold+=15;if(target.itemDrop)player.bag.push(target.itemDrop);}
}
if(s.type==="multi"){enemies.forEach(e=>{if(e.alive){e.hp-=Math.floor(player.atk*s.baseScale);if(e.hp<=0){e.alive=false;kills++;player.exp+=20;player.gold+=15;if(e.itemDrop)player.bag.push(e.itemDrop);}}});}
if(s.type==="control"){enemies.forEach(e=>{if(e.alive){if(s.stun)e.stun=2;if(s.poison)e.poison=3;}});}
if(s.type==="ult"){enemies.forEach(e=>{if(e.alive){e.hp-=Math.floor(player.atk*s.baseScale*2);if(e.hp<=0){e.alive=false;kills++;player.exp+=40;player.gold+=30;if(e.itemDrop)player.bag.push(e.itemDrop);}}});}
if(s.type==="heal"){player.hp=Math.min(player.maxHp,player.hp+player.maxHp*s.rate);}
endTurn(); render(); save();
}

// ===== Turn / 冷卻 & 怪物攻擊 =====
function endTurn(){
player.skills.forEach(s=>{if(s.now>0)s.now=Math.max(0,s.now-1);});
enemies.forEach(e=>{if(e.alive){player.hp-=Math.max(0,e.atk-player.def);}});
if(player.hp<=0){player.hp=Math.floor(player.maxHp*0.5);player.exp=Math.floor(player.exp*0.25);player.gold=Math.floor(player.gold*0.25);}
checkEnemies();
}

// ===== 檢查敵人 =====
function checkEnemies(){
if(enemies.every(e=>!e.alive)){
 if(kills>=need){zone++;kills=0;need+=15;}
 nextWave();
}
}

// ===== 商店 =====
function buyPotion(){if(player.gold<50)return;player.gold-=50;player.hp=Math.min(player.maxHp,player.hp+50);render();save();}

// ===== 裝備 =====
function renderEquip(){
document.getElementById("equip").innerHTML=
`武器：${player.equip.weapon?.name||"無"} 防具：${player.equip.armor?.name||"無"}`;
document.getElementById("bag").innerHTML=player.bag.map((i,idx)=>
`<div class="item" onclick="equipItem(${idx})">${i.name}</div>`).join("");
}
function equipItem(i){let item=player.bag.splice(i,1)[0];if(item.atk)player.equip.weapon=item;if(item.hp)player.equip.armor=item;renderEquip();render();save();}

// ===== UI 渲染 =====
function render(){
document.getElementById("info").innerHTML=
`Zone ${zone}　
<span class="hp">HP ${player.hp}/${player.maxHp}</span>　
<span class="mp">MP ${player.mp}/${player.maxMp}</span>　
<span class="gold">G ${player.gold}</span>`;
let e=document.getElementById("enemies"); e.innerHTML="<b>敵人</b><br>";
enemies.forEach(m=>{let d=document.createElement("div");d.className="enemy"+(m.alive?"":" dead");d.innerText=m.name+" HP:"+m.hp;e.appendChild(d);});
renderSkills(); renderEquip();
}
</script>
</body>
</html>
