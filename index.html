<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Turn RPG 8å€ å½©è‰²æ‰‹æ©Ÿç‰ˆ</title>
<style>
body { background:#111; color:#fff; font-family:sans-serif; margin:0; padding:10px; }
button { font-size:18px; padding:16px; margin:4px 0; width:100%; border-radius:12px; border:none; }
button:active{transform:scale(0.97);}
.panel { border:1px solid #444; padding:10px; margin-bottom:10px; border-radius:12px; }
.flex { display:flex; gap:6px; }
.flex button { flex:1; }
.monster { border:1px solid #666; padding:10px; margin:10px 0; border-radius:12px; }
.big { font-size:20px; padding:18px; border-radius:12px; margin:4px 0; }
</style>
</head>
<body>

<div class="panel" id="tutorial"></div>

<div class="panel">
<b>è§’è‰²é¸æ“‡</b>
<div class="flex">
<button style="background:#0099ff" onclick="choose('tank')">ğŸ›¡ å¦å…‹</button>
<button style="background:#ff5500" onclick="choose('warrior')">âš” åŠå£«</button>
<button style="background:#ffcc00;color:#000" onclick="choose('mage')">ğŸ”¥ æ³•å¸«</button>
<button style="background:#aa00ff" onclick="choose('assassin')">ğŸ—¡ åˆºå®¢</button>
</div>
</div>

<div class="panel" id="player"></div>
<div class="panel" id="zonePanel"></div>
<div class="panel" id="monsters"></div>
<div class="panel" id="actions"></div>
<div class="panel" id="bag"></div>
<div class="panel" id="skillTree"></div>

<script>
/* ===== æ•™å­¸ ===== */
if(!localStorage.tut){
tutorial.innerHTML="ğŸ“˜ æ•™å­¸ï¼šåˆ·æ€ªç´¯ç©æ“Šæ®º â†’ è§£é–Boss â†’ æ‹¿è£å‚™ â†’ é»æŠ€èƒ½æ¨¹ â†’ è³ªè®Šæ•ˆæœå½©è‰²é¡¯ç¤º";
localStorage.tut=1;
}

/* ===== å€åŸŸ & æ€ªç‰© ===== */
const ZONES={
1:{name:"è…åŒ–è‰åŸ", monsters:[{n:"è…åŒ–é‡ç‹¼",hp:28,atk:6},{n:"ç˜Ÿç–«é‡è±¬",hp:45,atk:5},{n:"æ¯’ç‰™èœ˜è››",hp:24,atk:5},{n:"è®Šç•°é£Ÿäººè‰",hp:40,atk:5},{n:"å¾©ç”¦éª·é«",hp:30,atk:6}]},
2:{name:"ç°ç‡¼ç¤¦å‘", monsters:[{n:"ç°ç‡¼ç¤¦å·¥",hp:42,atk:8},{n:"ç†”å²©å²èŠå§†",hp:55,atk:7},{n:"å¤±æ§é‘½æ©Ÿ",hp:60,atk:7},{n:"ç„¦ç¿¼è™è ",hp:32,atk:9},{n:"çˆ†è£‚å¹¼èŸ²",hp:26,atk:10}]},
3:{name:"é»‘éœ§æ²¼æ¾¤", monsters:[{n:"æ²¼æ¾¤æ¯’è›‡",hp:34,atk:9},{n:"è©›å’’å·«å±",hp:45,atk:8},{n:"å¸è¡€æ²¼èšŠ",hp:28,atk:7},{n:"é»‘éœ§å¹½å½±",hp:38,atk:9},{n:"è…æ²¼å·¨è›™",hp:60,atk:8}]},
4:{name:"è¡€æœˆå¤åŸ", monsters:[{n:"è¡€åƒ•",hp:35,atk:10},{n:"è¡€èª“é¨å£«",hp:50,atk:9},{n:"å¤œç¿¼é­”è ",hp:28,atk:11},{n:"è¡€æ± èšåˆé«”",hp:45,atk:8},{n:"è¡€æœˆè§€æ¸¬è€…",hp:40,atk:7}]},
5:{name:"è™›ç©ºè£‚éš™", monsters:[{n:"è™›ç©ºå•ƒå™¬è€…",hp:60,atk:12},{n:"æ¬¡å…ƒæ‰­æ›²é«”",hp:55,atk:10},{n:"è™›é›·æ ¸å¿ƒ",hp:50,atk:13},{n:"è£‚éš™è§€æ¸¬è€…",hp:45,atk:11},{n:"é»‘æ´å¹¼é«”",hp:65,atk:14}]},
6:{name:"éœœé›ªå±±è„ˆ", monsters:[{n:"å†°éœœå·¨ç‹¼",hp:50,atk:9},{n:"é›ªåŸç†Š",hp:70,atk:10},{n:"å†°åˆºç‹¼è››",hp:45,atk:8},{n:"å¯’é¢¨éˆ",hp:40,atk:7},{n:"å†°æ™¶çµè€…",hp:55,atk:11}]},
7:{name:"æš—å½±æ²¼æ¾¤", monsters:[{n:"æš—å½±è›‡",hp:42,atk:10},{n:"å¹½é­‚å·«å¸«",hp:48,atk:9},{n:"æ¯’éœ§å·¨èŸ¹",hp:55,atk:11},{n:"è¿·éœ§å¹»éˆ",hp:38,atk:10},{n:"é»‘æ³¥å·¨è›™",hp:60,atk:12}]},
8:{name:"ç‚é¾ç†”å·–", monsters:[{n:"ç†”å²©é¾å¹¼å´½",hp:70,atk:14},{n:"ç«ç„°å…ƒç´ ",hp:60,atk:15},{n:"ç†”å²©å·¨é­”",hp:80,atk:13},{n:"ç«ç„°è™è ",hp:50,atk:12},{n:"ç†”æ ¸å‚€å„¡",hp:90,atk:16}]}
};
function needKills(z){ return 45+(z-1)*30; }
function randMon(z){ const base=ZONES[z].monsters[Math.floor(Math.random()*ZONES[z].monsters.length)]; let m=JSON.parse(JSON.stringify(base)); m.maxHP=m.hp+z*10; m.hp=m.maxHP; m.atk+=z*2; m.stun=false; return m; }
function spawnBoss(){ return {n:"ğŸ‘‘ å€åŸŸBoss",maxHP:200+zone*120,hp:200+zone*120,atk:12+zone*4,phase:1,boss:true}; }

/* ===== è§’è‰²å®šç¾© ===== */
const CLASSES={
tank:{hp:160,atk:4,def:0.35,equipable:['weapon','sub','shield','ring']},
warrior:{hp:120,atk:6,def:0,equipable:['weapon','sub','ring']},
mage:{hp:90,atk:8,def:0,equipable:['weapon','sub','ring']},
assassin:{hp:100,atk:9,def:0,equipable:['weapon','sub','ring']}
};

/* ===== æŠ€èƒ½å®šç¾© ===== */
const SKILLS={
shieldStrike:{name:"ç›¾æ“Š",type:"single",baseM:2.0,cd:2,class:['tank']},
warCry:{name:"æˆ°å¼",type:"stun",cd:4,class:['tank','warrior']},
shieldWall:{name:"ç›¾ç‰†",type:"buff",cd:5,class:['tank']},
quakeSmash:{name:"å´©å±±æ“Š",type:"single",baseM:3.0,cd:6,class:['tank']},

slash:{name:"ç ´ç”²æ–¬",type:"single",baseM:2.2,cd:2,class:['warrior']},
whirlwind:{name:"æ—‹é¢¨æ–¬",type:"aoe",baseM:1.3,cd:3,class:['warrior']},
warShout:{name:"æˆ°å¼",type:"stun",cd:4,class:['warrior']},
judgment:{name:"è£æ±º",type:"single",baseM:3.5,cd:6,class:['warrior']},

fireball:{name:"ç«çƒ",type:"single",baseM:2.5,cd:2,class:['mage']},
meteor:{name:"éš•çŸ³",type:"aoe",baseM:1.6,cd:4,class:['mage']},
freeze:{name:"å†°å°",type:"stun",cd:4,class:['mage']},
disaster:{name:"å¤©ç½",type:"aoe",baseM:2.2,cd:7,class:['mage']},

backstab:{name:"èƒŒåˆº",type:"single",baseM:3.0,cd:3,class:['assassin']},
throwingBlade:{name:"é£›åˆƒ",type:"aoe",baseM:1.1,cd:3,class:['assassin']},
smoke:{name:"ç…™éœ§",type:"stun",cd:4,class:['assassin']},
shadowKill:{name:"å½±æ®º",type:"single",baseM:4.0,cd:6,class:['assassin']}
};

/* ===== ç©å®¶ ===== */
let player=null,monsters=[],zone=1,isBoss=false;
function choose(c){
  const b=CLASSES[c];
  player={class:c,lv:1,exp:0,sp:5,gold:0,maxHP:b.hp,hp:b.hp,atk:b.atk,def:b.def,
          kills:0,bossUnlocked:false,cds:[0,0,0,0],skillLv:[0,0,0,0],equip:{weapon:null,sub:null,shield:null,ring:null},bag:[]};
  player.skills = Object.values(SKILLS).filter(sk=>sk.class.includes(c));
  enterZone(1);
}

/* ===== Zone ===== */
function enterZone(z){
    zone = z;
    player.kills = 0;
    player.bossUnlocked = false;
    isBoss = false;
    monsters = [randMon(z), randMon(z)];

    // å½©è‰²æ–‡å­—æç¤º
    tutorial.innerHTML = `<span style="background:linear-gradient(90deg, #ff5555, #ffaa00, #55ff55, #55aaff, #aa55ff); -webkit-background-clip: text; color: transparent; font-weight:bold; font-size:20px;">
    ğŸŒŸ ä½ é€²å…¥äº† ${ZONES[z].name}ï¼</span>`;

    setTimeout(() => { tutorial.innerHTML = ""; }, 3000);

    render();
}

/* ===== æˆ°é¬¥ ===== */
function attack(i){
 let dmg=player.atk+equipBonus("atk");
 if(player.class=="assassin" && monsters[i].hp/monsters[i].maxHP<0.5 && Math.random()<0.3) dmg=9999;
 monsters[i].hp-=dmg; endTurn();
}
function skill(s,i){
 if(player.cds[s]>0)return;
 let sk = player.skills[s];
 let base=player.atk*(sk.baseM||1.5)*(1+0.2*player.skillLv[s]);
 let tier=player.skillLv[s];
 if(tier>=2){ if(sk.type=="single") base*=1.3; if(sk.type=="stun") monsters.forEach(m=>m.stun=true);}
 if(tier>=3){ base*=1.5; if(sk.type=="aoe") monsters.forEach(m=>m.hp-=5);}
 if(sk.type=="aoe") monsters.forEach(m=>m.hp-=base);
 else if(sk.type=="stun") monsters.forEach(m=>m.stun=true);
 else monsters[i].hp-=base;
 player.cds[s]=Math.max(1,sk.cd-player.skillLv[s]);
 endTurn();
}
function heal(){ player.hp=Math.min(player.maxHP,player.hp+player.maxHP*0.3); endTurn(); }

/* ===== å›åˆ ===== */
function endTurn(){
 player.cds=player.cds.map(c=>Math.max(0,c-1));
 monsters.forEach(m=>{ if(m.hp>0&&!m.stun) player.hp-=Math.floor(m.atk*(1-player.def)); m.stun=false; });
 monsters=monsters.filter(m=>m.hp>0);
 if(monsters.length==0){
  if(isBoss){ alert("ğŸ‰ Bossæ“Šæ•—ï¼"); dropEquip(); zone++; if(zone>8) zone=8; enterZone(zone); return; }
  player.kills++; if(player.kills>=needKills(zone)) player.bossUnlocked=true;
  monsters=[randMon(zone),randMon(zone)];
 } render();
}

/* ===== è£å‚™ ===== */
function dropEquip(){ player.bag.push({name:"é‹¼éµæ­¦å™¨",slot:"weapon",atk:2+zone*2}); }
function equipItem(i){ const it=player.bag[i]; if(it.slot=="sub"&&!["assassin","tank","mage"].includes(player.class)) return alert("ä¸èƒ½è£å‰¯æ­¦"); player.equip[it.slot]=it; player.bag.splice(i,1); render(); }
function equipBonus(type){ let v=0; Object.values(player.equip).forEach(e=>{if(e&&e[type])v+=e[type]}); return v; }

/* ===== æŠ€èƒ½æ¨¹ ===== */
function upSkill(i){ if(player.sp<=0)return; player.skillLv[i]++; player.sp--; render(); }

/* ===== UI ===== */
function render(){
 if(!player)return;
 player.maxHP=CLASSES[player.class].hp+equipBonus("hp");
 player.atk=CLASSES[player.class].atk+equipBonus("atk");

 playerDiv.innerHTML=`â¤ï¸${player.hp}/${player.maxHP} âš”${player.atk} ğŸ›¡${Math.floor(player.def*100)}% â­${player.lv}<br>æ“Šæ®º:${player.kills}/${needKills(zone)}`;

 zonePanel.innerHTML=`Zone ${zone}ï½œ${ZONES[zone]?.name||"æœªçŸ¥"}<br>${player.bossUnlocked?"ğŸ‘‘ Bosså·²è§£é–":""}${player.bossUnlocked?`<button class="big" style="background:#ff4444" onclick="monsters=[spawnBoss()];isBoss=true;render()">æŒ‘æˆ°Boss</button>`:""}`;

 monsters.innerHTML=monsters.map((m,i)=>`<div class="monster" style="color:${m.boss?'#ff8800':'#fff'};"><b>${m.n}</b><br>HP ${m.hp}/${m.maxHP}<button class="big" onclick="attack(${i})">æ™®æ”»</button>${player.skills.map((s,si)=>`<button class="big" onclick="skill(${si},${i})">${s.name} CD:${player.cds[si]}</button>`).join("")}</div>`).join("");

 actions.innerHTML=`<button class="big" style="background:#00aa00" onclick="heal()">ğŸ’šæ²»ç™‚</button>`;

 bag.innerHTML="<b>ğŸ’ èƒŒåŒ…</b><br>"+player.bag.map((it,i)=>`${it.name} [+${it.atk||0}æ”»] <button class="big" style="background:#ffaa00;color:#000;" onclick="equipItem(${i})">è£å‚™</button>`).join("<br>");

 skillTree.innerHTML="<b>ğŸŒ³ æŠ€èƒ½æ¨¹</b><br>æŠ€èƒ½é»ï¼š"+player.sp+"<br>"+player.skills.map((s,i)=>{
   let tier = player.skillLv[i]>=3?3:(player.skillLv[i]>=2?2:1);
   let color = tier==1?"#aaa":tier==2?"#ff0":"#ff8800";
   return `<div style="margin:6px 0;"><span style="color:${color}; font-weight:bold;">${s.name}</span> ç­‰ç´š:${player.skillLv[i]}<br><span style="color:${color};">è³ªè®Šå±¤ç´š:${tier}</span><br><button class="big" style="background:#444;color:white;" onclick="upSkill(${i})">å‡ç´š</button></div>`;
 }).join("");
}
</script>
</body>
</html>
