<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>Pixel RPG</title>
<style>
body{background:#0e0e0e;color:#eee;font-family:monospace}
#game{max-width:960px;margin:auto}
.box{border:1px solid #444;padding:8px;margin:6px 0}
.log{height:160px;overflow-y:auto;background:#000;padding:5px}
img{image-rendering:pixelated}
.char,.enemy{width:96px}
button{margin:2px;padding:6px 10px}
</style>
</head>
<body>

<div id="game">
<h2>Pixel RPG</h2>
<div class="box" id="mapBox"></div>
<div class="box" id="playerBox"></div>
<div class="box" id="enemyBox"></div>
<div class="box" id="actions"></div>
<div class="box"><div class="log" id="log"></div></div>
</div>

<script>
// ================= 角色 =================

const classes={
 warrior:{name:"戰士",hp:120,atk:15,img:"assets/player_warrior.png"},
 tank:{name:"坦克",hp:180,atk:10,img:"assets/player_tank.png",sub:"hp"},
 mage:{name:"法師",hp:90,atk:18,img:"assets/player_mage.png",sub:"atk15"},
 assassin:{name:"刺客",hp:95,atk:20,img:"assets/player_assassin.png",sub:"atk2"}
};

// ================= 8區怪物 =================

const zones=[

{name:"森林",monsters:[
{name:"史萊姆",hp:50,atk:8,img:"assets/forest_slime.png"},
{name:"野狼",hp:70,atk:11,img:"assets/forest_wolf.png"},
{name:"哥布林",hp:80,atk:12,img:"assets/forest_goblin.png"}
],boss:{name:"森林魔王",hp:180,atk:18,img:"assets/forest_boss.png"}},

{name:"洞窟",monsters:[
{name:"蝙蝠",hp:60,atk:10,img:"assets/cave_bat.png"},
{name:"骷髏",hp:90,atk:14,img:"assets/cave_skeleton.png"},
{name:"石怪",hp:120,atk:16,img:"assets/cave_golem.png"}
],boss:{name:"骸骨王",hp:260,atk:22,img:"assets/cave_boss.png"}},

{name:"沙漠",monsters:[
{name:"沙蟲",hp:100,atk:15,img:"assets/desert_worm.png"},
{name:"盜賊",hp:110,atk:17,img:"assets/desert_bandit.png"},
{name:"木乃伊",hp:140,atk:19,img:"assets/desert_mummy.png"}
],boss:{name:"沙漠王",hp:300,atk:25,img:"assets/desert_boss.png"}},

{name:"雪原",monsters:[
{name:"雪狼",hp:130,atk:18,img:"assets/snow_wolf.png"},
{name:"冰史萊姆",hp:120,atk:16,img:"assets/snow_slime.png"},
{name:"雪怪",hp:170,atk:21,img:"assets/snow_yeti.png"}
],boss:{name:"冰霜巨人",hp:340,atk:27,img:"assets/snow_boss.png"}},

{name:"遺跡",monsters:[
{name:"詛咒盔甲",hp:160,atk:22,img:"assets/ruin_armor.png"},
{name:"幽魂",hp:140,atk:20,img:"assets/ruin_ghost.png"},
{name:"古代獸",hp:190,atk:24,img:"assets/ruin_beast.png"}
],boss:{name:"古王",hp:380,atk:30,img:"assets/ruin_boss.png"}},

{name:"火山",monsters:[
{name:"熔岩怪",hp:180,atk:24,img:"assets/volcano_lava.png"},
{name:"火蜥蜴",hp:160,atk:22,img:"assets/volcano_lizard.png"},
{name:"炎魔",hp:210,atk:26,img:"assets/volcano_demon.png"}
],boss:{name:"炎龍",hp:420,atk:33,img:"assets/volcano_boss.png"}},

{name:"深淵",monsters:[
{name:"闇影獸",hp:200,atk:26,img:"assets/abyss_beast.png"},
{name:"墮落騎士",hp:230,atk:29,img:"assets/abyss_knight.png"},
{name:"混沌體",hp:260,atk:31,img:"assets/abyss_chaos.png"}
],boss:{name:"深淵王",hp:460,atk:36,img:"assets/abyss_boss.png"}},

{name:"魔界",monsters:[
{name:"魔兵",hp:240,atk:30,img:"assets/demon_soldier.png"},
{name:"地獄犬",hp:260,atk:32,img:"assets/demon_dog.png"},
{name:"魔將",hp:300,atk:35,img:"assets/demon_general.png"}
],boss:{name:"魔王",hp:550,atk:40,img:"assets/demon_king.png"}}

];

const goldMonster={name:"黃金史萊姆",hp:200,atk:24,img:"assets/gold_slime.png"};

// ================= 遊戲狀態 =================

let zoneIndex=0;
let player={job:"assassin",maxHP:0,hp:0,atk:0,potions:3,shield:0,reflect:0};
let enemy=null;
let status={burn:0,freeze:0};

// ================= 工具 =================

function log(t){let d=document.getElementById("log");d.innerHTML+=t+"<br>";d.scrollTop=d.scrollHeight;}
function r(min,max){return Math.floor(Math.random()*(max-min+1))+min;}

// ================= 初始化 =================

function initPlayer(){
 let c=classes[player.job];
 player.maxHP=c.hp; player.atk=c.atk;
 if(c.sub==="hp") player.maxHP=Math.floor(player.maxHP*1.25);
 if(c.sub==="atk15") player.atk=Math.floor(player.atk*1.5);
 if(c.sub==="atk2") player.atk=Math.floor(player.atk*2);
 player.hp=player.maxHP;
}

function renderMap(){
 let html="<b>選擇區域</b><br>";
 zones.forEach((z,i)=>html+=`<button onclick="enterZone(${i})">${z.name}</button>`);
 document.getElementById("mapBox").innerHTML=html;
}

function enterZone(i){zoneIndex=i;log("進入："+zones[i].name);spawnEnemy();}

function spawnEnemy(){
 status={burn:0,freeze:0};
 let roll=Math.random();
 if(roll<0.05) enemy={...goldMonster,maxHP:goldMonster.hp,gold:true};
 else if(roll<0.15){let b=zones[zoneIndex].boss;enemy={...b,maxHP:b.hp,boss:true};}
 else{let p=zones[zoneIndex].monsters;let m=p[r(0,p.length-1)];enemy={...m,maxHP:m.hp};}
 log("遭遇："+enemy.name);
 render();
}

// ================= 顯示 =================

function render(){
 let c=classes[player.job];
 document.getElementById("playerBox").innerHTML=
 `<b>${c.name}</b><br><img src="${c.img}" class="char"><br>
 HP:${player.hp}/${player.maxHP}<br>ATK:${player.atk}<br>藥水:${player.potions}`;
 document.getElementById("enemyBox").innerHTML=
 `<b>${enemy.name}</b><br><img src="${enemy.img}" class="enemy"><br>
 HP:${enemy.hp}/${enemy.maxHP}`;
 document.getElementById("actions").innerHTML=
 `<button onclick="attack()">攻擊</button>
  <button onclick="skill()">技能</button>
  <button onclick="potion()">藥水</button>`;
}

// ================= 戰鬥 =================

function attack(){
 enemy.hp-=r(player.atk-2,player.atk+2);
 afterPlayer();
}

function skill(){
 let dmg=0;
 if(player.job==="warrior"){
  for(let i=0;i<r(5,10);i++) dmg+=Math.floor(player.atk*0.8);
 }
 if(player.job==="tank"){player.reflect=1;player.shield=2;log("進入防禦姿態");}
 if(player.job==="mage"){dmg=Math.floor(player.atk*1.5);status.burn=3;log("火球術 + 灼燒");}
 if(player.job==="assassin"){
  if(enemy.hp<=enemy.maxHP*0.5 && Math.random()<0.1){dmg=enemy.hp;log("☠ 背刺必殺");}
  else dmg=Math.floor(player.atk*2)+150;
 }
 enemy.hp-=dmg;
 afterPlayer();
}

function potion(){
 if(player.potions<=0)return;
 player.potions--;
 player.hp=Math.min(player.maxHP,player.hp+Math.floor(player.maxHP*0.4));
 enemyTurn();
 render();
}

function afterPlayer(){
 if(enemy.hp<=0){log("擊敗 "+enemy.name);spawnEnemy();return;}
 enemyTurn();
 render();
}

function enemyTurn(){
 if(status.freeze>0){status.freeze--;log(enemy.name+" 被冰凍");return;}

 let dmg=r(enemy.atk-2,enemy.atk+2);
 if(player.shield>0){dmg=Math.floor(dmg*0.7);player.shield--;}
 player.hp-=dmg;
 if(player.reflect>0){enemy.hp-=Math.floor(dmg*2);player.reflect=0;}

 if(status.burn>0){enemy.hp-=10;status.burn--;}

 if(player.hp<=0){log("你死亡，復活");player.hp=player.maxHP;}
 if(enemy.hp<=0){log("擊敗 "+enemy.name);spawnEnemy();}
}

// ================= 啟動 =================

initPlayer();
renderMap();

</script>
</body>
</html>
