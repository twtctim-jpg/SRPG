<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>8 å€ RPGï¼ˆå®Œæ•´+5å“è³ªè£å‚™+Bossæ‰è½+çµ±è¨ˆï¼‰</title>
<style>
body{background:#1e1e1e;color:#eee;font-family:monospace}
.enemy,.shop{border:1px solid #777;padding:6px;margin:4px;display:inline-block;width:170px}
.dead{opacity:.3}
button{margin:4px}
#log{height:220px;overflow-y:auto;border:1px solid #555;padding:6px}
#dropStats{border:1px solid #555;padding:6px;min-height:80px;margin-top:4px}
</style>
</head>
<body>

<h2>8 å€ RPGï¼ˆå®Œæ•´+5å“è³ªè£å‚™+Bossæ‰è½+çµ±è¨ˆï¼‰</h2>
<div id="info"></div>
<button onclick="toggleShop()">å•†åº— / èƒŒåŒ…</button>
<div id="shop"></div>
<div id="enemies"></div>
<div id="actions"></div>
<div id="log"></div>

<h3>æ‰è½çµ±è¨ˆ</h3>
<div id="dropStats">å°šç„¡æ‰è½</div>

<script>
// ================= è§’è‰² =================
const ROLE={ assassin:{ maxHP:260,maxMP:90,atk:30, passive:{ dmg:t=>t.HP/t.maxHP<0.4?1.2:1 } } };

// ================= æŠ€èƒ½ =================
const SKILLS=[
 {name:"è‡´å‘½çªåˆº",mp:25,cd:3,use(p,t){
   if(t.HP/t.maxHP<0.5&&Math.random()<0.1){ t.HP=0;this.reset=true;return 0; }
   return getPlayerATK()*2.5;
 }},
 {name:"ç…™éœ§å‰²è£‚",mp:20,cd:4,aoe:true,use:p=>getPlayerATK()*0.8},
 {name:"å½±è¥²é€£æ–¬",mp:30,cd:3,chain:4,use:p=>getPlayerATK()*0.75},
 {name:"æš—å½±çµ‚çµ",mp:60,cd:6,use(p,t){
   let d=getPlayerATK()*3;
   if(t.HP-d<=0)p.MP=Math.min(p.maxMP,p.MP+30);
   return d;
 }}
];

// ================= è£å‚™å“è³ª =================
const EQUIP_QUALITY = [
  {name:"ç™½", multiplier:1}, {name:"ç¶ ", multiplier:1.1},
  {name:"è—", multiplier:1.25}, {name:"ç´«", multiplier:1.4},
  {name:"æ©™", multiplier:1.6}
];

// ================= åŸºç¤è£å‚™ =================
const BASE_EQUIPMENTS = [
  { name:"éµåŠ", type:"weapon", atk:5, hp:0, basePrice:50 },
  { name:"é‹¼åŠ", type:"weapon", atk:8, hp:0, basePrice:90 },
  { name:"çš®ç”²", type:"armor", atk:0, hp:30, basePrice:40 },
  { name:"é–ç”²", type:"armor", atk:0, hp:60, basePrice:80 }
];

function generateEquipment(base){
  const q = EQUIP_QUALITY[Math.floor(Math.random()*EQUIP_QUALITY.length)];
  return { ...JSON.parse(JSON.stringify(base)),
           quality:q.name,
           atk:Math.floor(base.atk*q.multiplier),
           hp:Math.floor(base.hp*q.multiplier),
           price:Math.floor(base.basePrice*q.multiplier) };
}

// ================= Boss å°ˆå±¬è£å‚™ =================
const BOSS_EQUIPMENTS = {
  1:[{name:"å“¥å¸ƒæ—ç‹ä¹‹æ–§",type:"weapon",atk:12,hp:0,basePrice:120}],
  2:[{name:"å¢“åœ°ä¸»å®°é­”ç›¾",type:"armor",atk:0,hp:60,basePrice:150}],
  3:[{name:"é»‘ç‹¼ç‹ç‰™åˆƒ",type:"weapon",atk:18,hp:0,basePrice:200}],
  4:[{name:"ç†”å²©é­”ç‹é§ç”²",type:"armor",atk:0,hp:80,basePrice:220}],
  5:[{name:"äº¡éˆç‹å’’æ–",type:"weapon",atk:25,hp:0,basePrice:300}],
  6:[{name:"å†°éœœå¥³ç‹å¯’ç”²",type:"armor",atk:0,hp:100,basePrice:350}],
  7:[{name:"æ²™æ¼ ä¹‹ç‹æ²™åˆƒ",type:"weapon",atk:28,hp:0,basePrice:380}],
  8:[{name:"åœ°ç„é ˜ä¸»æˆ°ç”²",type:"armor",atk:0,hp:120,basePrice:500}]
};

// ================= ç©å®¶ =================
let player={ ...ROLE.assassin, HP:260, MP:90, actions:1, gold:100,
 inventory:[], equipment:{weapon:null, armor:null}, skills:SKILLS, cds:{} };

// ================= å€åŸŸæ€ªç‰© =================
const mob=(n,h,a,g,d)=>({name:n,HP:h,maxHP:h,ATK:a,alive:true,gold:g,dropRate:d});
const ZONES={
1:{m:[mob("å²èŠå§†",90,10,10,0.25),mob("é‡ç‹¼",120,15,10,0.25),mob("å“¥å¸ƒæ—",110,14,10,0.25),mob("èœ˜è››",100,12,10,0.25)],b:mob("å“¥å¸ƒæ—ç‹",400,30,50,0.5)},
2:{m:[mob("éª·é«",150,18,12,0.25),mob("æ®­å±",170,16,12,0.25),mob("æš—çŠ¬",160,20,12,0.25),mob("æ¯’è ",155,22,12,0.25)],b:mob("å¢“åœ°ä¸»å®°",480,35,60,0.5)},
3:{m:[mob("ç‹¼äºº",200,28,15,0.3),mob("é»‘ç†Š",230,25,15,0.3),mob("æ¯’è›‡",180,24,15,0.3),mob("åœ°ç²¾",210,27,15,0.3)],b:mob("é»‘ç‹¼ç‹",520,40,80,0.5)},
4:{m:[mob("ç«å…ƒç´ ",240,32,18,0.3),mob("ç†”å²©è›‡",260,34,18,0.3),mob("é­”åƒ",280,36,18,0.3),mob("ç†”è ",250,30,18,0.3)],b:mob("ç†”å²©é­”ç‹",580,45,100,0.5)},
5:{m:[mob("æ­»éˆ",260,38,20,0.35),mob("éª·é«é¨å£«",290,40,20,0.35),mob("å¹½é­‚",240,35,20,0.35),mob("å·¨äºº",310,42,20,0.35)],b:mob("äº¡éˆç‹",630,50,120,0.5)},
6:{m:[mob("å†°å·¨äºº",320,45,25,0.35),mob("é›ªç‹¼",280,42,25,0.35),mob("å†°å…ƒç´ ",300,44,25,0.35),mob("å†°è››",270,40,25,0.35)],b:mob("å†°éœœå¥³ç‹",680,55,140,0.5)},
7:{m:[mob("æ²™è ",330,48,30,0.4),mob("åœŸç‹¼",310,46,30,0.4),mob("æ²™å½±",290,44,30,0.4),mob("æ¯’èŸ¹",350,50,30,0.4)],b:mob("æ²™æ¼ ä¹‹ç‹",720,60,160,0.5)},
8:{m:[mob("æƒ¡é­”å…µ",360,55,35,0.4),mob("åœ°ç„çŠ¬",380,58,35,0.4),mob("é­”è››",400,60,35,0.4),mob("å®ˆè¡›",420,62,35,0.4)],b:mob("åœ°ç„é ˜ä¸»",800,70,200,0.6)}
};

// ================= ç‹€æ…‹ =================
let zone=1,kills=0,need=45,boss=false;
let enemies=[];
const dropHistory=[];

// ================= åˆå§‹åŒ– =================
spawnZone(); ui(); log(`é€²å…¥ç¬¬ ${zone} å€ï¼Œéœ€æ±‚ ${need}`);

// ================= å•†åº— / èƒŒåŒ… =================
function toggleShop(){
 shop.innerHTML="";
 SHOP_ITEMS();
 showInventory();
}

function SHOP_ITEMS(){
 BASE_EQUIPMENTS.forEach((b,i)=>{
   const item = generateEquipment(b);
   const d = document.createElement("div");
   d.className="shop";
   d.innerHTML=`å•†åº—: ${item.quality} ${item.name} <br>åƒ¹éŒ¢: ${item.price}G`;
   d.onclick=()=>{ if(player.gold>=item.price){player.gold-=item.price; player.inventory.push(item); log(`è³¼è²· ${item.quality} ${item.name}`); ui(); updateStats(); } };
   shop.appendChild(d);
 });
}

function showInventory(){
 player.inventory.forEach((it,i)=>{
   const d = document.createElement("div");
   d.className="shop";
   d.innerHTML=`èƒŒåŒ…: ${it.quality} ${it.name}<br>ATK:${it.atk} HP:${it.hp}`;
   d.onclick=()=>{ equipItem(i); ui(); updateStats(); log(`è£å‚™ ${it.quality} ${it.name}`) };
   shop.appendChild(d);
 });
}

function equipItem(index){
 const item = player.inventory[index];
 if(!item) return;
 const type = item.type;
 if(player.equipment[type]) player.inventory.push(player.equipment[type]);
 player.equipment[type] = item;
 player.inventory.splice(index,1);
 player.HP = Math.min(player.HP,getPlayerMaxHP());
 updateStats();
}

// ================= å¯¦éš›èƒ½åŠ›å€¼ =================
function getPlayerATK(){ let atk = player.atk; if(player.equipment.weapon) atk+=player.equipment.weapon.atk; return atk; }
function getPlayerMaxHP(){ let hp=player.maxHP; if(player.equipment.armor) hp+=player.equipment.armor.hp; return hp; }

// ================= æˆ°é¬¥ =================
function spawnZone(){ enemies=[]; ZONES[zone].m.forEach(e=>enemies.push({...e})); boss=false; }
function spawnBoss(){ enemies.push({...ZONES[zone].b}); boss=true; log("Boss å‡ºç¾"); }

function useSkill(i,target){
 const s=player.skills[i];
 if(player.actions<=0||player.MP<s.mp||player.cds[s.name]>0)return;
 player.MP-=s.mp; player.actions=0; player.cds[s.name]=s.cd;

 if(s.aoe) enemies.filter(e=>e.alive).forEach(e=>hit(e,calc(s.use(player),e)));
 else if(s.chain) enemies.filter(e=>e.alive).slice(0,s.chain).forEach(e=>hit(e,calc(s.use(player),e)));
 else{
   let d=s.use(player,target);
   if(d>0)hit(target,calc(d,target));
   if(s.reset){player.cds[s.name]=0;s.reset=false;}
 }
 enemyTurn();
}

function calc(base,t){ let d=base; if(player.passive.dmg)d*=player.passive.dmg(t); return Math.floor(d); }

function hit(e,d){
 e.HP-=d; log(`${e.name} -${d}`);
 if(e.HP<=0){ 
  e.alive=false; kills++; player.gold+=e.gold; 
  dropLoot(e);
  if(kills>=need&&!boss)spawnBoss();
  if(boss && enemies.every(x=>!x.alive)){
    zone++; 
    if(zone>8){log("ğŸ‰ é€šé—œ");return;} 
    kills=0; need+=15; spawnZone(); log(`é€²å…¥ç¬¬ ${zone} å€`);
  }
 }
}

// ================= æ‰è½çµ±è¨ˆ =================
function dropLoot(enemy){
  if(boss){ 
    const bossLoots = BOSS_EQUIPMENTS[zone];
    bossLoots.forEach(base=>{
      const loot = generateEquipment(base);
      const q = EQUIP_QUALITY[Math.floor(Math.random()*3)+2]; // è—/ç´«/æ©™
      loot.quality = q.name;
      loot.atk = Math.floor(base.atk*q.multiplier);
      loot.hp = Math.floor(base.hp*q.multiplier);
      loot.price = Math.floor(base.basePrice*q.multiplier);
      player.inventory.push(loot);
      dropHistory.push({zone, name:loot.name, quality:loot.quality});
      log(`ğŸ¯ Boss æ‰è½ ${loot.quality} ${loot.name}`);
    });
  } else {
    if(Math.random() < enemy.dropRate){
      const base = BASE_EQUIPMENTS[Math.floor(Math.random()*BASE_EQUIPMENTS.length)];
      const loot = generateEquipment(base);
      player.inventory.push(loot);
      dropHistory.push({zone, name:loot.name, quality:loot.quality});
      log(`æ€ªç‰©æ‰è½ ${loot.quality} ${loot.name}`);
    }
  }
  updateStats();
}

function updateStats(){
  const statsDiv = document.getElementById("dropStats");
  const statMap = {};
  dropHistory.forEach(d=>{
    const key = `${d.quality} ${d.name}`;
    statMap[key] = (statMap[key]||0)+1;
  });
  let html="";
  for(let k in statMap){
    html += `${k} Ã—${statMap[k]}<br>`;
  }
  statsDiv.innerHTML = html || "å°šç„¡æ‰è½";
}

// ================= Enemy å›åˆ =================
function enemyTurn(){
 enemies.filter(e=>e.alive).forEach(e=>player.HP-=e.ATK);
 player.actions=1;
 for(let k in player.cds)if(player.cds[k]>0)player.cds[k]--;
 ui();
}

// ================= UI =================
function ui(){
 info.innerText=`å€:${zone} HP:${player.HP}/${getPlayerMaxHP()} MP:${player.MP}/${player.maxMP} é‡‘å¹£:${player.gold}`;
 enemiesDiv.innerHTML="";
 enemies.forEach(e=>{
   const d=document.createElement("div");
   d.className="enemy"+(e.alive?"":" dead");
   d.innerText=`${e.name} HP:${e.HP}`;
   if(e.alive)d.onclick=()=>useSkill(0,e);
   enemiesDiv.appendChild(d);
 });
 actions.innerHTML="";
 player.skills.forEach((s,i)=>{
   const b=document.createElement("button");
   b.innerText=`${s.name} MP${s.mp} CD${player.cds[s.name]||0}`;
   b.onclick=()=>useSkill(i,enemies.find(e=>e.alive));
   actions.appendChild(b);
 });
}

function log(t){logDiv.innerHTML+=t+"<br>"; logDiv.scrollTop=99999;}

const enemiesDiv=document.getElementById("enemies");
const actions=document.getElementById("actions");
const info=document.getElementById("info");
const logDiv=document.getElementById("log");
const shop=document.getElementById("shop");
</script>
</body>
</html>
