<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>八域勇者錄</title>
<style>
body{background:#0b0f1a;color:#eaeaff;font-family:monospace;}
h1{text-align:center;font-size:36px;background:linear-gradient(90deg,#ff4ecd,#6ae3ff,#9dff6a);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-shadow:0 0 12px rgba(255,255,255,.4);}
.panel{border:2px solid #3a4cff;border-radius:8px;padding:8px;margin:8px;background:rgba(20,30,60,.6);}
#info{border-color:#6ae3ff} #shop{border-color:#ffd36a} #enemies{border-color:#ff6a6a} #actions{border-color:#9dff6a}
button{background:#1a245a;color:#fff;border:1px solid #6ae3ff;border-radius:6px;padding:4px 8px;margin:3px;cursor:pointer;}
button:hover{background:#2f4cff}
.enemy.dead{opacity:.35}
#log{height:200px;overflow:auto;background:#050814;border:1px solid #444;}
.hp{color:#ff6a6a} .mp{color:#6ae3ff} .gold{color:#ffd36a}
#tutorial{position:fixed;top:10%;left:10%;width:80%;height:70%;background:rgba(30,30,60,0.95);border:2px solid #6ae3ff;border-radius:12px;padding:20px;overflow:auto;z-index:1000;}
#tutorial button{margin-top:15px;}
</style>
</head>
<body>
<h1>八域勇者錄</h1>

<div id="select" class="panel">
<button onclick="start('戰士')">戰士</button>
<button onclick="start('法師')">法師</button>
<button onclick="start('刺客')">刺客</button>
<button onclick="start('坦克')">坦克</button>
</div>

<div id="game" style="display:none">
<div id="info" class="panel"></div>
<div id="shop" class="panel"></div>
<div id="enemies" class="panel"></div>
<div id="actions" class="panel"></div>
<div id="log" class="panel"></div>
<button onclick="save()">存檔</button>
<button onclick="load()">讀檔</button>
</div>

<div id="tutorial" style="display:none">
<div id="tut-text"></div>
<button id="tut-next">下一步</button>
</div>

<script>
/* ===== 角色 ===== */
const ROLES={
戰士:{hp:130,mp:50,atk:12,def:5,skills:[
{name:"猛擊",type:"single",mp:10,scale:1.5,cooldown:0,cdMax:1},
{name:"旋風斬",type:"multi",mp:20,scale:0.8,cooldown:0,cdMax:3},
{name:"震地斬",type:"control",mp:15,scale:0,cooldown:0,cdMax:3},
{name:"破天斬",type:"ult",mp:30,scale:2,cooldown:0,cdMax:5},
{name:"回復術",type:"heal",mp:25,scale:0,cooldown:0,cdMax:2}
]},
法師:{hp:90,mp:100,atk:15,def:2,skills:[
{name:"火球",type:"single",mp:15,scale:1.5,cooldown:0,cdMax:1},
{name:"隕石",type:"multi",mp:20,scale:0.8,cooldown:0,cdMax:3},
{name:"冰封",type:"control",mp:15,scale:0,cooldown:0,cdMax:3},
{name:"雷神降臨",type:"ult",mp:30,scale:2,cooldown:0,cdMax:5},
{name:"治癒魔法",type:"heal",mp:25,scale:0,cooldown:0,cdMax:2}
]},
刺客:{hp:100,mp:60,atk:18,def:3,skills:[
{name:"背刺",type:"single",mp:10,scale:1.7,cooldown:0,cdMax:1},
{name:"疾風連斬",type:"multi",mp:20,scale:0.7,cooldown:0,cdMax:3},
{name:"毒霧",type:"control",mp:15,scale:0,cooldown:0,cdMax:3},
{name:"影舞大連擊",type:"ult",mp:30,scale:2,cooldown:0,cdMax:5},
{name:"急救",type:"heal",mp:25,scale:0,cooldown:0,cdMax:2}
]},
坦克:{hp:160,mp:40,atk:9,def:8,skills:[
{name:"聖擊",type:"single",mp:10,scale:1.2,cooldown:0,cdMax:1},
{name:"聖光波",type:"multi",mp:20,scale:0.8,cooldown:0,cdMax:3},
{name:"盾擊",type:"control",mp:15,scale:0,cooldown:0,cdMax:3},
{name:"天罰聖劍",type:"ult",mp:30,scale:2,cooldown:0,cdMax:5},
{name:"聖療",type:"heal",mp:25,scale:0,cooldown:0,cdMax:2}
]}
};

/* ===== 等級曲線 ===== */
const EXP_NEED=[0,50,120,220,350,520,740,1020,1400];

/* ===== 8 區怪物 ===== */
const ZONES=[
{m:["森林狼","毒蜂","巨鼠","樹精","蛇妖","石甲蟲","骷髏兵","魔草"],b:"森之守護者"},
{m:["荒原野狼","沙漠毒蜂","沙蟹","火蜥蜴","風行獸","沙石蟲","骷髏弓手","腐化草妖"],b:"荒原魔狼王"},
{m:["冰刺狼","雪狐","冰螯蟹","冰晶蜘蛛","霜狼","雪怪","凍骷髏","寒冰魔草"],b:"冰原雪王"},
{m:["毒蠍","岩蛛","熔岩蟲","火焰幼龍","熔岩草","灼骷髏","岩鼠","火蜂"],b:"火山巨人"},
{m:["叢林豹","藤蛇","毒螳","獵蛛","樹精戰士","藤蔓草","叢林骷髏","迷霧狼"],b:"叢林霸主"},
{m:["沙暴蜥","岩漠狼","沙蟲","熔蛛","烈焰蜂","沙骷髏","沙草","火沙蟹"],b:"沙漠魔王"},
{m:["幽影狼","暗蛛","夜蛇","腐骷髏","影草","夜狐","暗蠍","幽魂"],b:"暗影領主"},
{m:["雷狼","暴蜂","雷蛇","雷草","電骷","雷鳥","閃蛛","雷鼠"],b:"雷霆巨龍"}
];

/* ===== 狀態 ===== */
let P={},zone=0,kills=0,need=45,enemies=[],boss=false;

/* ===== 工具 ===== */
function log(t){
  let l=document.getElementById("log");
  l.innerHTML+=t+"<br>";
  l.scrollTop=l.scrollHeight;
}
function rnd(a,b){return Math.floor(Math.random()*(b-a+1))+a}

/* ===== 開始 ===== */
function start(role){
  let r=ROLES[role];
  P={
    role,level:1,exp:0,gold:100,
    maxHp:r.hp,hp:r.hp,
    maxMp:r.mp,mp:r.mp,
    atk:r.atk,def:r.def,
    skills:r.skills.map(s=>({...s,cooldown:0})), // 初始化技能冷卻
    equip:{weapon:0,armor:0}
  };
  document.getElementById("select").style.display="none";
  document.getElementById("game").style.display="block";
  nextWave();
  update();
}

// ===== 這裡省略其餘原本戰鬥、技能、商店、存檔、升級、Boss邏輯 =====

// ===== UI 更新技能按鈕 =====
function update(){
  document.getElementById("info").innerHTML=
  `Zone:${zone+1} Lv:${P.level} <span class="hp">HP:${P.hp}/${P.maxHp}</span> <span class="mp">MP:${P.mp}/${P.maxMp}</span> <span class="gold">Gold:${P.gold}</span> ATK:${P.atk+P.equip.weapon} DEF:${P.def+P.equip.armor} Kill:${kills}/${need}`;
  renderEnemies();
  let act=document.getElementById("actions");
  act.innerHTML="";
  P.skills.forEach(s=>{
    let btn=document.createElement("button");
    let cdText=s.cooldown>0?` (CD:${s.cooldown})`:"";
    btn.innerText=s.name+`(${s.mp}MP)`+cdText;
    btn.disabled=s.cooldown>0;
    btn.onclick=()=>{useSkill(s)};
    act.appendChild(btn);
  });
}

/* ===== 每回合技能冷卻減1 ===== */
function reduceCooldowns(){P.skills.forEach(s=>{if(s.cooldown>0)s.cooldown--})}

/* ===== 其他原本邏輯保持不變，包括怪物攻擊、存檔、讀檔、升級、Boss ===== */
</script>
</body>
</html>
